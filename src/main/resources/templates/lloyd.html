<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" data-theme="dark">

<head>
  <th:block th:replace="~{fragments/head :: header}"></th:block>
  <title>Práctica 3 - Lloyd</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
  <div th:replace="~{fragments/header :: header}"></div>
  <nav th:replace="~{fragments/navbar :: navbar}"></nav>

  <div class="container mt-4 text-center cuerpo-bayes p-10">
    <h2 class="text-2xl font-bold">Método de Lloyd</h2>

    <div class="mb-5">
      <h4 class="font-semibold text-lg">Parámetros de inicialización:</h4>
      <p style="text-align: center;">
        \[
        v =
        \begin{bmatrix}
        4.6 & 3.0 & 4.0 & 0.0 \\\\
        6.8 & 3.4 & 4.6 & 0.7
        \end{bmatrix}
        \]
    </p>
      <p>
        <strong>ε:</strong> 10⁻¹⁰ &nbsp;&nbsp;
        <strong>k<sub>max</sub>:</strong> 10 &nbsp;&nbsp;
        <strong>α:</strong> 0.1
      </p>
    </div>

    <div class="mb-4">
      <button class="btn btn-primary" onclick="ejecutarLloyd()">
        Ejecutar algoritmo de Lloyd
      </button>
    </div>

    <div id="resultado-lloyd" class="mt-5 text-left"></div>
  </div>

  <script>
    function ejecutarLloyd() {
      const container = document.getElementById("resultado-lloyd");
      container.innerHTML = `
        <div class="text-center">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Calculando...</span>
          </div>
          <p>Ejecutando algoritmo de Lloyd...</p>
        </div>
      `;

      fetch("/lloyd", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          v1: [4.6, 3.0, 4.0, 0.0],
          v2: [6.8, 3.4, 4.6, 0.7],
          epsilon: 1e-10,
          kmax: 10,
          alpha: 0.1
        }),
      })
        .then((response) => response.json())
        .then((data) => {
          const latexVector = (v) => `\\[ \\begin{bmatrix} ${v.map(n => n.toFixed(2)).join(" \\\\ ")} \\end{bmatrix} \\]`;
          
          let html = `
            <h4 class="font-bold mb-2">Resultados finales:</h4>
            <p><strong>Centroide 1:</strong> ${latexVector(data.v1)}</p>
            <p><strong>Centroide 2:</strong> ${latexVector(data.v2)}</p>
            <p><strong>Número de iteraciones:</strong> ${data.iteraciones}</p>
            <h5 class="mt-4">Asignación de Clusters:</h5>
            <ul class="list-disc pl-6">
              ${data.asignaciones.map((cluster, i) => `<li>Muestra ${i + 1}: Cluster ${cluster + 1}</li>`).join("")}
            </ul>
          `;

          container.innerHTML = html;
          if (window.MathJax) MathJax.typesetPromise();
        })
        .catch((error) => {
          console.error("Error al ejecutar Lloyd:", error);
          container.innerHTML =
            '<div class="alert alert-danger">Error al ejecutar el algoritmo de Lloyd</div>';
        });
    }
  </script>

  <footer th:replace="~{fragments/footer :: foot}"></footer>
</body>

</html>
